# Configuring cWeed

cWeed configuration is handled through a `config.json` file in the `config` directory of your cWeed installation. 

None of these options are required to test out cWeed. cWeed will run 
entirely on defaults if no `config.json` is given. Also, the `config.json`
only needs to contain the options which the user wishes to specify. 
default values will be used for the rest of the configuration setup. 

It is also advised but technically not necessary to use absolute paths
for any paths included in `config.json`. the relative root will be where
cWeed is run from and that is expected to be the cWeed installation 
directory at this time.


>below is an example of a `config.json` file

```json
{
	"scriptDirectories": ["scripts"],
	"maxThreadCount": 5,
	"pollingInterval": 1,
	"screenshotDirectory": "path/to/screenshots/dir",
    "resultsDirectory": "path/to/wherever/results/files/should/be/kept",
	"browsers": [{
		"browser": "chrome",
		"browserOpts": ["--headless", "--incognito"],
		"driverLocation": "path/to/drivers/drivers"
	}],
	"logs": {
		"logDirectory": "path/to/custom/log/directory",
		"fileSizeLimit" 10,
		"severity": 1
	},
	"credentialsRequestScript": {
		"credScriptPath": "path/to/the/script.ext",
		"credRunnerPath": "path/to/the/script/runner" 
	},
	"canopyConfig": {
		"elementTimeout" = 5.0,
		"compareTimeout" = 5.0,
		"pageTimeout" = 5.0
	}
}
```

## App Configuration 

An overview of the options that can be configured

option | requirement | description 
|--|--|--|
scriptDirectories | Optional | a list of directories where the user's transactions are located. 
maxThreadCount | Optional | how many threads cWeed transaction runner may use to run transactions in parallel
pollingInterval | Optional | how frequently polling for which transactions to run will occur
screenshotDirectory | Optional | path to screenshots for failures 
browsers | Optional | list of browsers configurations. At this time only chrome is supported
logs | Optional | logging configurations 
credentialsRequestScript | Optional | location and runner for a user provided credentials request script
canopyConfig | Optional | additional canopy configurations 


## Script Directories 

```json 
"scriptDirectories": [string]
```

This option configures what directoried cWeed will watch and pull transaction files from. The files contain `.dt` 
extensions represent the tests to be run. They are written in FSharp and composed into full `.fsx` files to be run 
by cWeed. The composed files will go into the `staging` directory of the application, and the directory structure will  
mirror the script directory provided. 

> The default value for this option is the `scripts` directory in the application directory

## Max Thread Count 

```json
"maxThreadCount": int
```

This option configures how many threads cWeed will use for running transactions. The transactions run in parallel. 

> The default value for this is `4`. 

## Polling Interval

```json 
"pollingInterval": int
```

This configures how frequently cWeed will poll for transactions to run. The time is given in `minutes`. 

> The default value is `5`

## Screenshot Directory 

```json 
"screenshotDirectory": "/path/to/screenshots"
```


The path for screenshots upon transaction failure. The structure will mirror the staging/scripts structure 

> By default the `screenshots` directory in the application directory 


## Results Directory 

```json
"resultsDir": string
```
The path for `{transactionfilename}_results.csv` files generated by cWeed. See Transaction Results Publishing for more 
details on what data cWeed publishes. 

### Date Formatting 

> example date 
`20230710_124421`

dates for results are rounded to the presicison of seconds. The format is YYYYMMDD_HHmmss 


## Browsers

Browsers is an array of `BrowserConfiguration` objects. cWeed is currently only set up to handle the first 
entry. Any others will be ignored.

```json 
"browsers": [
    {
        "browser": "chrome",
        "driverDir": "path/to/chrome/driver",
        "browserOpts": [
            "--headless", "--incognito"
        ]
    }
]
```

### Browser 

```json 
"browser": string
```

This is the only required field for the browser configuration object. it is the browser name in lowercase. 
since chrome is the only supported browser at this time, the value would always need to be "chrome".


### Driver Directory 

```json 
"driverDir": string
```

At this time cWeed only supports chrome. The user needs to obtain the appropriate chrome driver for their 
version of chrome and either specify its location in this configuration or put the driver in the default location

> the default location for the driverDir is `drivers` directory of the application

### Browser Opts 

```json 
"browserOpts": string array
```

These are the flags to be run as browser options through canopy. Here's a list of them for chrome: 

https://peter.sh/experiments/chromium-command-line-switches/

enter them in an array, with the `--` prepending the flag name, just as they appear as command line switches. 
cWeed will add these into the transactions when composing them. 

> There are no default flags currently set up

## Logs 

The logs option contains a `LoggingConfiguration` object, and describes how the logs should be configured. 
There are defaults for all of the options. 

```json 
"logs" : {
    "logDirectory": "/path/to/custom/log/directory",
	"fileSizeLimit" 10,
	"severity": 1
}
```

### Log Directory 

```json 
"logDirectory": string
```

The path to where the user would like to have the logs. If this option is ommited, cWeed will use the 
default log path. 

> The default value is the `logs` directory in the application. 

### File Size Limit 

```json 
"fileSizeLimit": int
```

cWeed rolls log files after they reach a limit size.  The file size limit confguration option allows the 
user to specify in `MB` how large a file should be before cWeed rolls it. the format for a rolled log 
file is as follows 

`{firstEntryTimestamp}_{rollTimeStamp}_{logname}.log`

### Severity 

```json 
"severity": int
```

cWeed has multiple levels of logging that can be configured ranging from `Debug` to `Critical`. The range 
specified by the user is inclusive and should be the most verbose logging the user desires to have. 

Severity is expressed as an integar value with `0` signifying debug, to `4` signifying critical. 

Severity | Int | Description
|--|--|--|
DEBUG | 0 | Debugging logs, mostly for development
INFO | 1 | Informational logs 
WARN | 2 | These considerations will not stop the program from running but may warn of an underlying issue
ERROR | 3 | These can cause the program to halt and signify an issue that needs to be resolved. 
CRITICAL | 4 | These are errors that come from reaching unreachable branches or other highly unexpected behaviors and will halt the program.

> the default value is `1`, covering logging information ranging from `INFO` to `CRITICAL`, inclusive


## Credentials Request Script

```json 
"credentialsRequestScript": {
	"credScriptPath": "path/to/the/script.ps1",
	"credRunnerPath": "usr/bin/pwsh"  
}
```

cWeed can be configured to retreive credentials for use in tranasactions if the user provides a path to the credential request script and 
the runner for that script. for example, on a linux machine running powershell the user could configure this option as described above. 

```json
"credScriptPath": string 
```
Path to the script that needs to be run. See Credential Request Script for more information on set up the script. This script can be in 
the language the user desires to write it in, as long as the correct runner for it is provided. 

```json
"credRunnerPath": string
```

Path to the executable that runs the type of script the user intends to use. A 
full path should be provided. 


## Additional Canopy Configuration


```json
"canopyConfiguration": {
	"compareTimeout": float,
	"pageTimeout": float,
	"elementTimeout": float
}
```
cWeed uses canopy for much of its functionality. These options are canopy 
configurations that haven't been accounted for in other settings. cWeed will 
pass these configurations through to canopy when it builds transactions. 

Not all of these options are available yet, and some are part of other 
configuration steps. 

> See [canopy Configuration](https://lefthandedgoat.github.io/canopy//Docs/configuration.html) for a full list of the configuration options 
> available to canopy.
